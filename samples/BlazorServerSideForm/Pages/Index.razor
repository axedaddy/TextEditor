@page "/"
@using BlazorServerSideForm.Components

<PageTitle>Blazored Rich Edit Input Test</PageTitle>

@if (Context is null || Model is null)
    return;

<EditForm EditContext=Context OnValidSubmit=OnSubmit class="mt-0">
    <DataAnnotationsValidator />

    <BlazoredInputRichEdit Label="Description" @bind-Value=Model.Description ValidationFor="()=>Model.Description"></BlazoredInputRichEdit>

    <button type="submit" class="btn btn-primary mt-4">Submit</button>

    <ValidationSummary></ValidationSummary>
</EditForm>

<h4 class="mt-2">Submitted Html:</h4>
<p>
    [@Html]
</p>

<hr class="my-5"/>

@if (Context2 is null || Model2 is null)
    return;

<EditForm EditContext=Context2 OnValidSubmit=OnSubmit2 class="mt-0">
    <DataAnnotationsValidator />

    <BlazoredInputRichEdit Label="Description" @bind-Value=Model2.Description ValidationFor="()=>Model2.Description"></BlazoredInputRichEdit>

    <button type="submit" class="btn btn-primary mt-4">Submit</button>

    <ValidationSummary></ValidationSummary>
</EditForm>

<h4 class="mt-2">Submitted Html:</h4>
<p>
    [@Html2]
</p>

@code
{
    private TestViewModel? Model { get; set; }
    private EditContext Context { get; set; } = null!;
    private string? Html { get; set; } = string.Empty;

    private TestViewModel? Model2 { get; set; }
    private EditContext Context2 { get; set; } = null!;
    private string? Html2 { get; set; } = string.Empty;


    protected override async Task OnInitializedAsync()
    {
        Model = new TestViewModel { Description = "<p>html going in</p>" };
        Context = new EditContext(Model);

        Model2 = new TestViewModel { Description = "<p>More Html on the way in</p>" };
        Context2 = new EditContext(Model2);

        await base.OnInitializedAsync();
    }

    private void OnSubmit()
    {
        Html = Model?.Description;
        StateHasChanged();
    }


    private void OnSubmit2()
    {
        Html2 = Model2?.Description;
        StateHasChanged();
    }

    public class TestViewModel
    {
        public string? Description { get; set; }
    }
}
